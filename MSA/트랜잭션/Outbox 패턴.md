### Outbox 패턴

![Image](https://github.com/user-attachments/assets/00e0d46c-e039-41aa-bca2-243b20a3c395)

#### 1. 개요
Outbox 패턴은 분산 시스템에서 데이터 일관성을 보장하고, 트랜잭션과 메시지 전달을 일관성 있게 처리하기 위한 아키텍처 패턴이다. 이 패턴은 주로 이벤트 소싱이나 메시지 큐와 결합하여 사용되며, 데이터베이스의 트랜잭션과 이벤트 전달을 독립적으로 관리한다.

#### 2. 동작 방식
1. **트랜잭션과 메시지 분리**: 서비스가 트랜잭션을 처리할 때, 데이터베이스에 변경된 내용을 **Outbox**라는 테이블에 기록한다. Outbox 테이블에는 이벤트와 해당 데이터가 저장되어, 나중에 메시지 큐로 전송된다.

2. **메시지 큐로의 전송**: 별도의 프로세스가 일정 주기로 Outbox 테이블을 확인하여, 처리되지 않은 이벤트를 메시지 큐나 이벤트 버스로 전송한다. 이로 인해 서비스 간 통신이 이루어진다.

3. **이벤트 처리**: 메시지 큐에서 전송된 이벤트는 다른 서비스에서 처리되며, 필요한 작업을 수행한다.

#### 3. 사용 이유
- **데이터 일관성 보장**: 데이터베이스에 트랜잭션을 처리하면서 발생한 이벤트를 Outbox 테이블에 기록하여, 데이터 변경과 이벤트를 동일한 트랜잭션 내에서 관리할 수 있다.

- **이벤트 중복 방지**: Outbox 테이블에 저장된 이벤트는 메시지 큐로 전송되기 전에 관리되므로 중복된 이벤트 전송을 방지할 수 있다.

#### 4. 장점
- **트랜잭션 일관성**: 데이터 변경과 이벤트 생성을 동일한 트랜잭션 안에서 처리하여 데이터 일관성을 보장한다.
- **비동기 처리**: 이벤트를 비동기적으로 처리하여 시스템의 성능을 개선하고, 서비스 간의 느슨한 결합을 유지할 수 있다.
- **재시도 가능성**: 이벤트 처리에 실패한 경우, 메시지 큐에서 재시도가 가능하여 시스템의 신뢰성을 높인다.

#### 5. 단점
- **추가적인 관리 필요**: Outbox 테이블과 메시지 큐의 관리가 추가적으로 필요하여 시스템의 복잡도가 증가한다.
- **복잡성 증가**: 이벤트 전송과 처리에 대한 추가적인 코드 및 프로세스가 필요하여 시스템 설계가 복잡해질 수 있다.

#### 6. 결론
Outbox 패턴은 분산 시스템에서 트랜잭션 일관성을 보장하면서도 이벤트 전송을 안정적으로 처리할 수 있는 유용한 방법이다. 이를 통해 시스템의 신뢰성 및 성능을 개선할 수 있지만, 추가적인 관리와 복잡성을 수반한다.