# 강한 일관성과 최종적 일관성

## 1. 개요
일관성은 데이터의 무결성을 유지하는 중요한 개념이며, 대표적으로 **강한 일관성(Strong Consistency)**과 **최종적 일관성(Eventual Consistency)**이 있다.

## 2. 강한 일관성(Strong Consistency)
* 모든 읽기 연산이 항상 최신 데이터를 반환한다.
* 변경이 발생하면 즉시 모든 노드에 반영된다.
* **장점**: 데이터 무결성이 강력하게 보장됨.
* **단점**: 분산 시스템에서는 성능 저하와 가용성 문제 발생 가능.

### 강한 일관성의 예
* **관계형 데이터베이스(RDBMS)**: MySQL, PostgreSQL 등은 기본적으로 트랜잭션을 통해 강한 일관성을 보장한다.
* **Google Spanner**: 글로벌 분산 데이터베이스이면서도 TrueTime API를 통해 강한 일관성을 제공한다.
* **ZooKeeper**: 분산 시스템 조정을 위한 서비스로, 모든 노드가 동일한 상태를 유지하도록 강한 일관성을 보장한다.
* **금융 거래 시스템**: 계좌 잔액, 송금 내역 등의 금융 데이터는 항상 최신 상태를 반영해야 하므로 강한 일관성이 필수적이다.

## 3. 최종적 일관성(Eventual Consistency)
* 일정 시간이 지나면 모든 노드가 동일한 데이터를 가지게 된다.
* 즉시적인 데이터 동기화는 보장하지 않지만, 점진적으로 일관성을 유지한다.
* **장점**: 높은 성능과 가용성을 제공.
* **단점**: 최신 데이터가 즉시 반영되지 않을 수 있음.

### 최종적 일관성의 예
* **Amazon DynamoDB**: 기본적으로 최종적 일관성을 제공하며, 필요에 따라 강한 일관성 읽기도 지원한다.
* **Apache Cassandra**: 높은 가용성과 확장성을 위해 최종적 일관성 모델을 채택했다.
* **DNS(Domain Name System)**: 도메인 변경 사항이 전 세계 DNS 서버에 완전히 전파되는 데 시간이 걸린다.
* **소셜 미디어 플랫폼**: 페이스북이나 트위터 같은 서비스에서 좋아요나 댓글 수가 모든 사용자에게 즉시 동일하게 보이지 않을 수 있다.

## 4. NoSQL과 최종적 일관성
* NoSQL 데이터베이스는 확장성과 가용성을 우선시하므로, 강한 일관성보다 최종적 일관성을 채택하는 경우가 많다.
* **CAP 이론**에 따라, 네트워크 파티션이 발생할 때 가용성을 유지하기 위해 최종적 일관성을 보장하는 구조를 선택한다.
* 예: DynamoDB, Cassandra 등은 최종적 일관성을 제공하며, 강한 일관성이 필요한 경우 추가적인 설정이 필요하다.

## 5. MSA(Microservice Architecture)와 최종적 일관성
MSA에서는 주로 최종적 일관성 모델을 채택하는데, 이는 다음과 같은 이유에서 비롯된다:

### MSA에서 최종적 일관성을 선호하는 이유
* **서비스 독립성**: 각 마이크로서비스는 자체 데이터베이스를 가지며 독립적으로 운영된다. 강한 일관성을 위한 분산 트랜잭션은 서비스 간 결합도를 높인다.
* **확장성**: 각 서비스가 자체적으로 확장될 수 있어야 하는데, 강한 일관성은 이러한 독립적 확장을 제한할 수 있다.
* **가용성 유지**: 한 서비스의 장애가 다른 서비스에 영향을 미치지 않아야 하는데, 분산 트랜잭션은 전체 시스템의 가용성을 저하시킬 수 있다.
* **성능 최적화**: 분산 트랜잭션은 동기식 통신을 요구하여 성능이 저하될 수 있다. 최종적 일관성은 비동기 통신을 통해 더 나은 성능을 제공한다.
* **이벤트 기반 아키텍처**: MSA에서는 이벤트 기반 통신이 널리 사용되며, 이는 본질적으로 최종적 일관성 모델을 따른다.

### MSA에서 일관성 구현 패턴
* **Saga 패턴**: 분산 트랜잭션을 일련의 로컬 트랜잭션으로 분해하고, 각 단계가 실패할 경우 보상 트랜잭션을 통해 일관성을 유지한다.
* **이벤트 소싱(Event Sourcing)**: 상태 변화를 이벤트로 저장하고, 이벤트를 재생하여 현재 상태를 구성한다.
* **CQRS(Command Query Responsibility Segregation)**: 명령(쓰기)과 조회(읽기) 모델을 분리하여 각각 최적화할 수 있게 한다.

## 6. 결론
* 강한 일관성은 데이터 무결성을 보장하지만, 분산 시스템에서는 성능 저하를 초래할 수 있다.
* 최종적 일관성은 고가용성을 유지하면서도 일정 시간 후 데이터 동기화를 보장하는 방식이다.
* NoSQL과 같은 분산 데이터베이스에서는 최종적 일관성을 활용하여 확장성과 성능을 극대화한다.
* MSA에서는 서비스 독립성, 확장성, 가용성을 위해 최종적 일관성 모델이 더 적합하며, 다양한 패턴을 통해 데이터 일관성 문제를 해결한다.
* 시스템 설계 시 비즈니스 요구사항에 따라 적절한 일관성 모델을 선택하는 것이 중요하다.