<configuration>
    <property name="LOG_FILE" value="application-dev.log"/>

    <!-- Logstash로 전송할 Appender -->
    <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
        <destination>localhost:5044</destination>
        <!--        LogstashEncoder는 자동으로 logstash 실행 설정 파일의 인코딩 방식으로 변환하여 로그를 전달-->
        <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
    </appender>

    <!-- 콘솔 출력 -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{yyyy-MM-dd HH:mm:ss} prod %-5level [%thread] %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>

    <!-- 파일 출력 -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${LOG_FILE}</file>
        <!-- 로그가 기록될 파일의 경로 및 이름을 설정 (환경 변수 LOG_FILE 사용 가능) -->
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!-- 로그 파일을 일정 주기로 새로운 파일로 분리하는 정책을 설정 -->
            <fileNamePattern>application.%d{yyyy-MM-dd_HH-mm}.log.gz</fileNamePattern>
            <!--            <fileNamePattern>application.%d{yyyy-MM-dd}.log.gz</fileNamePattern>-->
            <!-- 로그 파일의 이름 패턴을 지정
                 - %d{yyyy-MM-dd_HH-mm} : 날짜 및 시간 단위로 새로운 로그 파일을 생성
                 - .gz : 로그 파일을 압축하여 저장 -->
            <maxHistory>5</maxHistory>
            <!--            <maxHistory>30</maxHistory>-->
            <!-- 보관할 로그 파일의 최대 개수를 지정 (5개 이전의 파일은 자동 삭제) -->
        </rollingPolicy>
        <encoder>
            <!-- 로그 형식을 정의하는 부분 -->
            <pattern>%d{yyyy-MM-dd HH:mm:ss} %-5level [%thread] %logger{36} - %msg%n</pattern>
            <!-- 로그 출력 패턴을 설정
                 - %d{yyyy-MM-dd HH:mm:ss} : 로그 발생 시간
                 - %-5level : 로그 레벨 (INFO, ERROR 등)
                 - [%thread] : 실행 중인 스레드 이름
                 - %logger{36} : 로거 이름 (최대 36자)
                 - %msg : 로그 메시지
                 - %n : 개행 문자 -->
        </encoder>
    </appender>

    <!-- Logger 설정 -->
    <!--    info 이상 log들은 console과 file에 출력하도록 한다-->
    <root level="info">
        <appender-ref ref="LOGSTASH"/>
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="FILE"/>
    </root>
</configuration>